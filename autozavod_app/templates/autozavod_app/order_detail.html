{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Подробная информация о распоряжении</title>
    <link rel="stylesheet" href="{% static 'autozavod_app/css/detail_info.css' %}">
</head>
<body>
    
    <a href="{% url 'all_orders' %}" class="back-button">Назад</a>
   
    <header class="header">
        <h1>Меню распоряжений</h1>
    </header>
    <main>  
        <section class="order-info">
            <h2>{{ order.name }}</h2>
            <div class="status">
                {% if order.status == "Y" %}
                    <span class="status-text active">Действующий</span>
                {% else %}
                    <span class="status-text inactive">Архив</span>
                {% endif %}
                {% if order.link %}
                <div>
                    <a href="{{ order.link.url }}" target="_blank" class="btn-pred">Предпросмотр файла</a>
                    {% else %}
                    <span>Файл не загружен</span>
                </div>
                    {% endif %}
                    <!-- Добавьте кнопку редактирования -->
                    <a href="{% url 'edit_order' order.id %}" class="edit-button">
                        <i class="fas fa-pencil-alt"></i> Редактировать
                    </a>
            </div>          
        </section>

        <section class="details">
            <div class="id_doc">
                <h3>id распоряжения</h3>
                <p class="value">{{ order.id_doc }}</p>
            </div>
            <div class="workshop">
                <h3>Цех</h3>
                {% for workshop in order.workshop.all %}
                <p>{{ workshop }}</p>
                {% endfor %}
            </div>
            <div class="evp_class">
                <h3>Группа ознакомления</h3>
                {% for evp_class in order.evp_class.all %}
                <p>{{ evp_class }}</p>
                {% endfor %}
            </div>
            <div class="date">
                <h3>Дата выпуска:</h3>
                <p>{{ order.release_date|date:"d.m.Y" }}</p>
            </div>
            {% if order.comment %}
            <div class="comment">
                <h3>Комментарий:</h3>
                <p>{{ order.comment }}</p>
            </div>
            {% endif %}
        </section>

        <footer class="actions">
            <h3 class='actions_head'>Список действий</h3>
        
            {% if order.process.count %}
        
            <ul>
                {% for process in order.process.all %}
                <div class="process_span">
                    {% for action in process.action.all %}
                        <span>{{ action }}</span>
                    {% endfor %}
                    <span>{{ process.type }}</span>
                    <span>{{ process.name_doc }}</span>
                    {% for action in process.responsible_process.all %}
                        <span>{{ action }}</span>
                    {% endfor %}
                    <span>{{ process.date_deadline|date:"d.m.Y" }}</span>
                    <span>{{ process.release_date|date:"d.m.Y" }}</span>
                    <span>
                        <input type="checkbox" class="status-checkbox" data-process-id="{{ process.id }}" 
                               {% if process.status_procces %} checked {% endif %}>
                        {% if process.status_procces %}
                            <span class='process-true'>Выполнен</span>
                        {% else %}
                            <span class='process-false'>Требует действий</span>
                        {% endif %}
                    </span>
                    <span>{{ process.comment }}</span>
                    
                    {% if process.link %}
                        <span> <a href="{{ process.link.url }}" download class="btn btn-download">Скачать</a></span>  
                    {% else %}
                        <span class="btn btn-disabled">Файл отсутствует</span>
                    {% endif %}
                                        
                    
                    <button class="delete-process-btn" data-process-id="{{ process.id }}" onclick="confirmDelete({{ process.id }})">
                        Удалить
                    </button>
        
                </div>
                {% endfor %}
            </ul>
            {% else %}
            <p>Нет действий для данного распоряжения. </p>
        
            {% endif %}
            <button id="add-process-btn" class="add-process-btn" onclick="window.location.href='{% url 'add_process_order' order.id %}'">
                Добавить новый процесс
            </button>
        </footer> 

        <section class="details">
            <h3>Ознакомление сотрудников</h3>
            <div class="employee-list">
                <div class="not-acquainted">
                    <h4>Не ознакомлены:</h4>
                    <ul>
                        {% for employee in order.responsible_not.all %}
                            <li>{{ employee.name }} 
                                <button onclick="acquaintEmployee({{ employee.id }}, {{ order.id }})">Ознакомить</button>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="acquainted">
                    <h4>Ознакомлены:</h4>
                    <ul>
                        {% for employee in order.responsible.all %}
                            <li>{{ employee.name }} 
                                <button onclick="unacquaintEmployee({{ employee.id }}, {{ order.id }})">Отменить ознакомление</button>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <button onclick="acquaintAll({{ order.id }})">Ознакомить всех</button>
            <button onclick="unacquaintAll({{ order.id }})">Отменить ознакомление всех</button>
            <script src="{% static 'autozavod_app/js/employee_order.js' %}"></script>
        </section>   

        <section class='details'>
            <h3 class='status-details'>Статусы выполнения</h3>
            
            <div>
                <h3>Ознакомление с распоряжением:</h3>
                {% if order.responsible_not.all %}
                 <span class="process-false">Не выполнено</span>
                 {% else %}
                 <span class="process-true">Выполнено</span>
                 {% endif %}
                 
            </div>

            <div>
                <h3>Действия по приказу</h3>
                
                {% if all_completed_process %}
                    <span class="process-true">Выполнено</span>
                {% else %}
                    <span class="process-false">Не выполнено</span>
                {% endif %}
            </div>
            
            

            <div>
                <h3>Отвественные за распоряжение</h3>
                {% for employee in order.mayor.all %}
                <ol>{{ employee.name }} , {{employee.id_number}};</ol>
                {% endfor %}
            </div>


        </section>
        

        <div id="deleteModal" class="modal">
            <div class="modal-content">
                <p>Вы уверены, что хотите удалить этот процесс?</p>
                <button id="confirmDeleteBtn">Да, удалить</button>
                <button id="cancelDeleteBtn">Отмена</button>
            </div>
        </div>

        <script src="{% static 'autozavod_app/js/delete_process.js' %}"></script>
        

    </footer>